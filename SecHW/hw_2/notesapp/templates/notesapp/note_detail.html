{% extends "base.html" %}
{% block content %}

<h2>Note: детально ({{ mode }})</h2>

<p><b>ID:</b> {{ obj.id }}</p>
<p><b>Owner:</b> {{ obj.owner.username }}</p>
<p><b>Title:</b> {{ obj.title }}</p>

<div class="card">
  <strong>Обновление заметки</strong>
  <form method="post" action="/vuln/note/update/{{ obj.id }}/">
    {% csrf_token %}
    <input name="title" placeholder="Новое значение">
    <button type="submit">Обновить</button>
  </form>
  <p class="muted">Проверка прав доступа выполняется на сервере.</p>
</div>

<p><a href="/secure/note/list/">Вернуться к списку</a></p>

{% endblock %}

{# ===============================================================
   УДАЛЕНО
  ---------------------------------------------------------------

  <span id="ownerName">{{ obj.owner.username }}</span>

  <button id="updBtn" type="submit" disabled>Обновить</button>

  <script>
  try{ 
    var currentUser = localStorage.getItem('currentUser') || 'guest';
    var owner = document.getElementById('ownerName').innerText.trim();
    if(currentUser === owner){ 
        document.getElementById('updBtn').disabled = false; 
    }
  }catch(e){}
  </script>

  ПОЧЕМУ УДАЛЕНО
  1 Проверка "имею ли я право" делалась через localStorage - клиентская уязвимость
  2 Кнопку можно было включить вручную через F12
    Теперь сервер возвращает 403, если пользователь не владелец заметки
================================================================ #}
